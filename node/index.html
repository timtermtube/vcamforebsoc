<!DOCTYPE html>
<html>
    <head>
        <script src="https://unpkg.com/peerjs@1.3.1/dist/peerjs.min.js"></script>
        <script type="text/javascript">
            window.onload = () => {
            document.getElementById("navigator").innerHTML = navigator.appVersion;
            const peer = new Peer("videoProvider", {
                host: "address Please", 
                port: 20500, 
                debug: 1, 
                path: "/peer"
            });
            const cameraMediaRunner = document.createElement("video");
            cameraMediaRunner.id = "media-runner"
            const canvas = document.createElement("canvas");
            canvas.width = 1080; canvas.height = 1920;
            const ctx = canvas.getContext("2d")
            const FRAME = 30;

            function status(bool) {
                if (bool == true) {
                    document.getElementById("status").style.backgroundColor = "#2c6ba0"
                }
                else if (bool == false) {
                    document.getElementById("status").style.backgroundColor = "#ff5555"
                }
            }
            
            navigator.getUserMedia({
                audio: false,
                video: {
                    width: 1280,
                    height: 720
                }
            },
            (stream) => {
                /* Streaming */
                cameraMediaRunner.srcObject = stream;
                cameraMediaRunner.onloadedmetadata = () => {
                    cameraMediaRunner.play();
                    document.getElementById("preview").appendChild(cameraMediaRunner);
                };

                const call = peer.call("beProvidedCamera", stream);
                setInterval(() => {
                    if (call._open == true) {
                        status(true)
                    }
                    else {
                        status(false)
                    }
                }, 1000);
                window.onresize = () => {
                    call.answer({
                        w: cameraMediaRunner.videoWidth,
                        h: cameraMediaRunner.videoHeight
                    }, "changeRatio")
                }
            },
            (error) => {
                /* Error */
                status(false);
                console.error(`Errored on the System: ${String(error)}`);
            });
            }
        </script>
        <style>
            @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@300&display=swap');
            body {
                position: fixed;
                width: 100%;
                height: 100%;
                margin: 0;
                padding: 0px;
                background-color: rgb(230, 230, 230);
            }
            .header {
                position: relative;
                width: 100%;
                height: 60px;
                background-color: rgb(244, 244, 244);
            }

            #status {
                position: absolute;
                width: 25px;
                height: 25px;
                background-color: #ff5555;
                right: 5%;
                top: 50%;
                transform: translateY(-50%);
                border-radius: 50%;
            }
            #preview {
                position: absolute;
                width: 100%;
                height: 70%;
                background-color: #dadada;
            }
            #media-runner {
                position: absolute;
                left: 50%;
                transform: translateX(-50%);
                height: 100%;
            }
            #configure {
                position: fixed;
                height: 30%;
                text-align: center;
                bottom: -14%;
                width: 80%;
                left: 50%;
                transform: translateX(-50%);
            }
        </style>
    </head>

    <body>
        <script>
            /* errorlog:
                if error: background: rgb(234,182,181), border: rgb(204,79,56)
                nope: 
            */
        </script>
        <div id="wrapper">
            <div class="header">
                <div style="
                    position: relative;
                    text-align: left;
                    font-size: 26px;
                    font-family: 'Roboto', sans-serif;
                    font-weight: 300;
                    top: 50%;
                    transform: translateY(-50%);
                    left: 30px;
                    color: rgb(49, 49, 49);
                    ">ebsocWrapper/rtc/previewer</div>
                <div id="status"></div>
            </div>

            <div id="contents">
                <div id="preview">
                </div>
            </div>
            <div id="configure">
                <p id="navigator"></p>
            </div>
        </div>
    </body>
</html>
